# Authentication System

Система аутентификации SONAR Web3 обеспечивает безопасное подключение
пользователей к сети через кошелек и выбор узла.

## Архитектура

### 1. Auth Store (`src/stores/modules/auth.store.ts`)

- Управление состоянием кошелька
- Конфигурация сетей (testnet, mainnet, localnet)
- Подключение к узлу с подписанной транзакцией
- Персистентность данных

### 2. Компоненты аутентификации

#### WalletSetup (`src/components/auth/WalletSetup.tsx`)

- Создание нового кошелька
- Импорт существующего кошелька
- Отображение информации о кошельке
- Скачивание приватного ключа

#### NetworkSelector (`src/components/auth/NetworkSelector.tsx`)

- Выбор сети для подключения
- Отображение конфигурации сети
- Индикация developer режима

#### ConnectionFlow (`src/components/auth/ConnectionFlow.tsx`)

- Полный flow аутентификации
- Прогресс-индикаторы
- Обработка ошибок подключения

#### ConnectionStatus (`src/components/auth/ConnectionStatus.tsx`)

- Отображение статуса подключения в Layout
- Информация о сети и кошельке
- Возможность отключения/выхода

## Алгоритм подключения

1. **Создание/импорт кошелька**
   - Пользователь генерирует новый кошелек или импортирует существующий
   - Используется библиотека gliesereum.ts для криптографических операций

2. **Выбор сети**
   - Пользователь выбирает сеть: testnet, mainnet или localnet
   - Каждая сеть имеет свою конфигурацию API и WebSocket

3. **Подключение к узлу**
   - Создается транзакция LOGIN_REQUEST
   - Транзакция подписывается приватным ключом кошелька
   - Отправляется запрос на подключение к узлу
   - Сервер возвращает сессию и токен

4. **Установка WebSocket соединения**
   - Используется полученная сессия для WebSocket подключения
   - Устанавливается соединение для real-time данных

## Безопасность

- **Приватные ключи**: Никогда не логируются и не передаются в открытом виде
- **Подписи**: Используется ECDSA secp256k1 для подписания транзакций
- **Сессии**: Хранятся в localStorage с шифрованием
- **Валидация**: Все адреса и подписи проверяются

## Интеграция с роутингом

Система контролирует доступ к приложению:

- Если пользователь не аутентифицирован - показывается ConnectionFlow
- После успешного подключения - открывается доступ ко всем маршрутам
- WebSocket соединение устанавливается только после аутентификации

## Конфигурация сетей

```typescript
interface NetworkConfig {
  id: string; // testnet, mainnet, localnet
  name: string; // Отображаемое имя
  api: string; // API endpoint
  socket: string; // WebSocket endpoint
  developer: boolean; // Developer режим
  description?: string; // Описание сети
}
```

## Использование

```typescript
import { useAuthStore } from "@/stores";

const {
  isAuthenticated,
  isConnected,
  wallet,
  connectionSession,
  connectToNode,
  disconnectFromNode,
} = useAuthStore();
```
